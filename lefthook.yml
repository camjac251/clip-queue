# Lefthook git hooks configuration
# https://github.com/evilmartians/lefthook
#
# Skip hooks: LEFTHOOK=0 git commit (or --no-verify)
#
# Strategy: Fast commits, tested pushes
# - pre-commit: format + typecheck + lint (catches errors fast)
# - commit-msg: validate message format
# - pre-push: test (slower, runs before push)

# Assert mise versions before running hooks
assert_lefthook_installed: true

pre-commit:
  # Skip all hooks if SKIP_HOOKS=1
  skip:
    - run: '[ "$SKIP_HOOKS" = "1" ]'

  commands:
    format:
      glob: '*'
      run: pnpm prettier --write --ignore-unknown {staged_files}
      stage_fixed: true

    typecheck-lint:
      run: pnpm turbo run typecheck lint --filter='...[HEAD]' --output-logs=errors-only --concurrency=100%

commit-msg:
  # Skip if SKIP_HOOKS=1
  skip:
    - run: '[ "$SKIP_HOOKS" = "1" ]'

  commands:
    commitlint:
      run: pnpm commitlint --edit {1}

pre-push:
  # Skip if SKIP_HOOKS=1
  skip:
    - run: '[ "$SKIP_HOOKS" = "1" ]'

  commands:
    build-test:
      run: pnpm turbo run build test --output-logs=errors-only --concurrency=100%
