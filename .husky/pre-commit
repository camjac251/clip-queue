# Skip if SKIP_HOOKS=1 (for LLM workflows: SKIP_HOOKS=1 git commit)
[ "$SKIP_HOOKS" = "1" ] && exit 0

# Format staged files only (automatically re-stages changes)
echo "ğŸ¨ Formatting staged files..."
npx lint-staged || exit 1

# Run typecheck, lint, and test on changed packages + their dependents
echo "ğŸ” Running typecheck, lint, and tests on changed packages..."
# Filter explanation:
#   --filter='...[HEAD]' = changed packages since last commit + their dependents
#   --output-logs=new-only = show output for tasks that haven't been cached
#   --concurrency=100% = use all CPU cores for parallel execution
turbo run typecheck lint test --filter='...[HEAD]' --output-logs=new-only --concurrency=100% || exit 1

echo "âœ… Pre-commit checks passed!"
